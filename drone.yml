kind: pipeline
type: docker
name: default

steps:
  - name: test build
    image: alpine:3.13
    commands:
      - apk --update add python3 py3-pip gcc python3-dev musl-dev libffi libffi-dev openssl-dev openssl
      - pip3 install ansible
      - ansible-galaxy collection build


steps:
  - name: test
    image: docker:dind
    volumes:
    - name: dockersock
      path: /var/run
    commands:
    - apk --update add curl
    - sleep 2
    - docker pull nextcloud:21-apache
    - docker run -d --rm -name nextcloud -p 80:80 -e NEXTCLOUD_ADMIN_USER=ansible -e NEXTCLOUD_ADMIN_PASSWORD=ansible nextcloud:21-apache
    - sleep 2
    - curl 127.0.0.1:80

services:
  - name: docker
    image: docker:dind
    privileged: true
    volumes:
    - name: dockersock
      path: /var/run

volumes:
  - name: dockersock
    temp: {}